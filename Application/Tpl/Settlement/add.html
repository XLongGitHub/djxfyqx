<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>结算单</title>
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <style>
        label {
            font-size: 25px;
        }
        .text-center {
            text-align: center
        }
    </style>
</head>
<body>
<form  action="{:U('Settlement/modify')}" method="POST" id="myForm">
<input type="text" name="settle_id" value="{$settle_id}">
<table class="table table-bordered">
    <caption class="text-center"><h1>垫江县福源汽修</h1></caption>
    <tr>
        <td colspan="12" class="text-center"><h4>结算单</h4></td>
    </tr>
    <tr>
        <td>送修单位</td>
        <td colspan="7"><input type="text" name="repair_unit" value="{$data['repair_unit']}"/></td>
        <td>工号</td>
        <td colspan="3"><input type="text" name="job_number" value="{$data[job_number]}"></td>
    </tr>
    <tr>
        <td>车牌号</td>
        <td colspan="3"><input type="text" name="plate_number" value="{$data['plate_number']}"></td>
        <td>联系人</td>
        <td colspan="3"><input type="text" name="contact_man" value="{$data['contact_man']}"></td>
        <td>联系电话</td>
        <td colspan="3"><input type="text" name="contact_phone" value="{$data['contact_phone']}"></td>
    </tr>
    <tr>
        <td>车型</td>
        <td colspan="3"><input type="text" name="car_type" value="{$data['car_type']}"></td>
        <td>底盘号</td>
        <td colspan="3"><input type="text" name="chassis_number" value="{$data['chassis_number']}"></td>
        <td>发动机号</td>
        <td colspan="3"><input type="text" name="engine_number" value="{$data['engine_number']}"></td>
    </tr>
    <tr>
        <td>送修日期</td>
        <td colspan="3"><input type="text" name="start_repair_date" value="{$data['start_repair_date']}"></td>
        <td>里程</td>
        <td colspan="3"><input type="text" name="mileage" value="{$data['mileage']}"></td>
        <td>维修类型</td>
        <td colspan="3"><input type="text" name="repair_type" value="{$data['repair_type']}"></td>
    </tr>
    <tr>
        <td colspan="12" class="text-center"><h4>维修内容</h4></td>
    </tr>
    <tr>
        <td>序号</td>
        <td colspan="6">维修项目</td>
        <td>工时费</td>
        <td>工段</td>
        <td colspan="2">维修人</td>
        <td>性质</td>
    </tr>
    <tr>
        <td>1</td>
        <td colspan="6"></td>
        <td></td>
        <td></td>
        <td colspan="2"></td>
        <td></td>
    </tr>
    <tr>
        <td colspan="12" class="text-center"><a href="#" class="btn btn-primary">添加维修内容</a></td>
    </tr>
    <tr>
        <td colspan="12" class="text-center"><h4>材料清单</h4></td>
    </tr>
    <tr>
        <td>序号</td>
        <td colspan="2">配件件号</td>
        <td colspan="3">配件名称</td>
        <td>单位</td>
        <td>单价</td>
        <td>数量</td>
        <td colspan="2">金额</td>
        <td>性质</td>
    </tr>
    <foreach name="materials" item="material">
        <tr>
            <td>1</td>
            <td colspan="2">{$material.number}</td>
            <td colspan="3">{$material.name}</td>
            <td>{$material.unit}</td>
            <td name="{$material}-unit_price">{$material.unit_price}</td>
            <td><input type="text" value="{$material.quantity}" name="{$material.material_id}-quantity"></td>
            <td colspan="2"><input type="text" value="{$material.money}" name="{$material.material_id}-money"></td>
            <td>{$material.nature}</td>
        </tr>
    </foreach>
    <tr>
        <td colspan="12" class="text-center"><a href="{:U('Material/chooseMaterial?settle_id='.$settle_id)}" class="btn btn-primary">添加维修材料</a></td>
    </tr>
    <tr style="height: 50px;">
        <td>材料费</td>
        <td>管理费</td>
        <td>材料优惠</td>
        <td>工时费</td>
        <td>工时优惠</td>
        <td>辅料费</td>
        <td>外加工</td>
        <td>其他费用</td>
        <td>三包/事故材料</td>
        <td>优惠</td>
        <td>三包/事故工时</td>
        <td>优惠</td>
    </tr>
    <tr>
        <td>0.00</td>
        <td>0.00</td>
        <td>0.00</td>
        <td>0.00</td>
        <td>0.00</td>
        <td>0.00</td>
        <td>0.00</td>
        <td>0.00</td>
        <td>0.00</td>
        <td>0.00</td>
        <td>0.00</td>
        <td>0.00</td>
    </tr>
    <tr>
        <td colspan="2">三包/事故费用</td>
        <td colspan="2"></td>
        <td>优惠合计</td>
        <td colspan="2"></td>
        <td>应付</td>
        <td colspan="4"></td>
    </tr>
    <tr>
        <td colspan="2">正常费用合计</td>
        <td colspan="2"></td>
        <td>优惠合计</td>
        <td colspan="2"></td>
        <td>车主应付</td>
        <td colspan="2"></td>
        <td>预付金额</td>
        <td></td>
    </tr>
    <tr>
        <td colspan="2">应收费用大写</td>
        <td colspan="5"></td>
        <td>收款(车主)</td>
        <td colspan="2"></td>
        <td>欠款(车主)</td>
        <td></td>
    </tr>
    <tr>
        <td>备注</td>
        <td colspan="6"></td>
        <td>付款方式</td>
        <td></td>
        <td>顾客签字</td>
        <td colspan="2"></td>
    </tr>
    <tr>
        <td>地址</td>
        <td colspan="6"><input type="text" name="address" value="{$data['address']}"></td>
        <td>联系方式</td>
        <td colspan="4"><input type="text" name="my_contact_method" value="{$data['my_contact_method']}"></td>
    </tr>
    <tr>
        <td>传真</td>
        <td colspan="2"><input type="text" name="fax" value="{$data['fax']}"></td>
        <td>结算人</td>
        <td colspan="3"><input type="text" name="settle_man" value="{$data['settle_man']}"></td>
        <td>结算日期</td>
        <td colspan="4"><input type="text" name="settle_date" value="{$data['settle_date']}"></td>
    </tr>
    <tr>
        <td>开户行</td>
        <td colspan="6"><input type="text" name="open_bank" value="{$data['open_bank']}"></td>
        <td>账号</td>
        <td colspan="4"><input type="text" name="account" value="{$data['account']}"></td>
    </tr>
    <tr>
        <td colspan="12" class="text-center">
                <input type="button" class="btn btn-success btn-lg" name="" value="保存结算单" onclick="formSubmit()"/>
        </td>
    </tr>
    <tr>
        <td colspan="12" class="text-center"><h3>谢谢惠顾</h3></td>
    </tr>
</table>
</form>
<script>

    function formSubmit() {
        document.getElementById("myForm").submit();
    }

    window.onload = function() {
        var quantities = document.querySelectorAll("input[name$='quantity']");
        var moneyAll = document.querySelectorAll("input[name$='money']");
        var unit_prices = document.querySelectorAll("td[name$='unit_price']");
        // alert(quantities.length);
        for (let i = 0; i < quantities.length; i++) {
            // alert("fafa");
            quantities[i].addEventListener('keyup', () => {
                let money = 0;
                let quantity = quantities[i].value;
                let unit_price = unit_prices[i].innerText;
                money = quantity * unit_price;
                moneyAll[i].value = money;
            } );
        }
    }
</script>
</body>
</html>